"use strict";Object.defineProperties(exports,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}});const c=require("fs"),d=require("path"),T=require("glob/sync.js"),y=e=>e&&typeof e=="object"&&"default"in e?e:{default:e};function w(e){if(e&&e.__esModule)return e;const t=Object.create(null,{[Symbol.toStringTag]:{value:"Module"}});if(e){for(const n in e)if(n!=="default"){const r=Object.getOwnPropertyDescriptor(e,n);Object.defineProperty(t,n,r.get?r:{enumerable:!0,get:()=>e[n]})}}return t.default=e,Object.freeze(t)}const p=y(d),m=y(T);function k(){return()=>{}}function b(e){return e}function S(){}function v(e){if(Array.isArray(e))return function(r){return r.map(s=>v(s))}(e);e=function(r={}){return function(s=k,o=b,i=S,j={}){r.src=s,r.proc=o,r.sink=i,r.meta=j}(r.src,r.proc,r.sink,r.meta),r}(e);let t=e.src,n=e.proc(t,e.meta);return e.sink(n,e.meta)}function f(e,t){return n=>e(n,t)}function l(e){return typeof e=="object"?d.format(e):e}const A="./src/task/*.js";let a;const u={},g=e=>u[e.id]=e;function P(e){const t={id:p.default.basename(a||"",p.default.extname(a||"")),url:a,...e};g(t)}function h(){process.listenerCount("task")==0&&process.on("task",P)}exports.bypass=b,exports.clean=function e(t,n){return Array.isArray(t)?void t.forEach(r=>e(r)):(t=l(t),m.default(t).forEach(r=>{c.rmSync(r,{recursive:!0,force:!0,...n==null?void 0:n.options})}),t)},exports.dummySink=S,exports.dummySrc=k,exports.hasTask=e=>u[e]!==void 0,exports.initApi=()=>process.env.VESIC_API=!0,exports.listenTask=h,exports.loadTasks=async function(e=A){h();const t=await m.default(e,{});for(let n of t)a=n,await Promise.resolve().then(()=>w(require(p.default.resolve(n))))},exports.meta=f,exports.parallel=function(...e){return(t,n)=>e.map(r=>r(t,n))},exports.print=function(e){console.log(e)},exports.readFile=function(e,t){return e=l(e||(t==null?void 0:t.path)),c.readFileSync(e,(t==null?void 0:t.options)||"utf-8")},exports.registerTask=g,exports.runTask=function(e,t,n){t={id:e,...t};const r=Date.now();u[e].main(t,n);const s=Date.now();return{start:r,stop:s,dur:s-r}},exports.series=function(...e){return(t,n)=>e.reduce((r,s)=>s(r,n),t)},exports.stream=function(e,t,n){let r,s;return{src(o){return e=o,this},done:()=>n,meta(o){return t=o,this},useProc(o){return r=o,this},proc(o,i){return i&&this.meta(i),typeof o=="object"&&(o=f(r,o)),e=o(e,t||{}),this},useSink(o){return s=o,this},sink(o,i){return i&&this.meta(i),typeof o=="object"&&(o=f(s,o)),n=o(e,t||{}),this},series(...o){return o.forEach(i=>this.proc(i)),this},parallel(...o){return o.forEach(i=>this.sink(i)),this}}},exports.task=function(e){process.env.VESIC_API==="true"?process.emit("task",e):e.main()},exports.tasks=u,exports.unregisterTask=e=>u[e]=void 0,exports.vesic=v,exports.writeFile=function(e,t){let n=l(t==null?void 0:t.path);const r=d.dirname(n);return c.mkdirSync(r,{recursive:!0}),c.writeFileSync(n,e.toString(),t==null?void 0:t.options),e};
