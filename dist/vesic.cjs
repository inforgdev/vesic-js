"use strict";Object.defineProperties(exports,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}});const c=require("fs"),h=require("path"),E=require("glob/sync.js"),k=t=>t&&typeof t=="object"&&"default"in t?t:{default:t};function O(t){if(t&&t.__esModule)return t;const e=Object.create(null,{[Symbol.toStringTag]:{value:"Module"}});if(t){for(const n in t)if(n!=="default"){const r=Object.getOwnPropertyDescriptor(t,n);Object.defineProperty(e,n,r.get?r:{enumerable:!0,get:()=>t[n]})}}return e.default=t,Object.freeze(e)}const _=k(c),f=k(h),m=k(E);function g(){return()=>{}}function j(t){return t}function T(){}function w(t){if(Array.isArray(t))return function(r){return r.map(i=>w(i))}(t);let e=(t=function(r={}){return function(i=g,s=j,l=T,p={}){r.src=i,r.proc=s,r.sink=l,r.meta=p}(r.src,r.proc,r.sink,r.meta),r}(t)).src,n=t.proc(e,t.meta);return t.sink(n,t.meta)}function d(t){return typeof t=="object"?h.format(t):t}const q="./src/task/*.js",P={glob:"./src/**/*.js",delay:100};let u;const o={},A=t=>o[t.id]=t,y=t=>o[t]!==void 0;function b(t,e,n){e={id:t,...e};const r=Date.now();o[t].main(e,n);const i=Date.now();return{start:r,stop:i,dur:i-r}}function F(t){const e={id:f.default.basename(u||"",f.default.extname(u||"")),url:u,...t};A(e)}function v(){process.listenerCount("task")==0&&process.on("task",F)}let a;function S(t=P.glob){return a=m.default(t),t}exports.bypass=j,exports.chain=function(){let t={pipe:void 0,meta:void 0,sink:void 0,curProc:void 0,curSink:void 0};return{src(e){return t.pipe=e,this},done:()=>t.sink,meta(e){return t.meta=e,this},useProc(e){return t.curProc=e,this},proc(e,n){return n&&this.meta(n),typeof e=="object"&&(e=meta(t.curProc,e)),t.pipe=e(t.pipe,t.meta||{}),this},useSink(e){return t.curSink=e,this},sink(e,n){return n&&this.meta(n),typeof e=="object"&&(e=meta(t.curSink,e)),t.sink=e(t.pipe,t.meta||{}),this},series(...e){return e.forEach(n=>this.proc(n)),this},parallel(...e){return e.forEach(n=>this.sink(n)),this}}},exports.clean=function t(e,n){return Array.isArray(e)?void e.forEach(r=>t(r)):(e=d(e),m.default(e).forEach(r=>{c.rmSync(r,{recursive:!0,force:!0,...n==null?void 0:n.options})}),e)},exports.dummySink=T,exports.dummySrc=g,exports.hasTask=y,exports.hasWatchables=()=>a.length>0,exports.initApi=()=>process.env.VESIC_API=!0,exports.initWatch=S,exports.isTaskRunnable=function(t){return!(!y(t)||!o[t].main)&&typeof o[t].main=="function"},exports.listenTask=v,exports.loadTasks=async function(t=q){v();const e=await m.default(t,{});for(let n of e)u=n,await Promise.resolve().then(()=>O(require(f.default.resolve(n))))},exports.meta=function(t,e){return n=>t(n,e)},exports.parallel=function(...t){return(e,n)=>t.map(r=>r(e,n))},exports.print=function(t){console.log(t)},exports.readFile=function(t,e){return t=d(t||(e==null?void 0:e.path)),c.readFileSync(t,(e==null?void 0:e.options)||"utf-8")},exports.registerTask=A,exports.runTask=b,exports.series=function(...t){return(e,n)=>t.reduce((r,i)=>i(r,n),e)},exports.task=function(t){process.env.VESIC_API==="true"?process.emit("task",t):t.main()},exports.tasks=o,exports.unregisterTask=t=>o[t]=void 0,exports.vesic=w,exports.watchTask=function(t,e){e={...P,...e},!a&&S(e.glob);const n={id:t,...e};a.forEach((r,i)=>{let s=!1;_.default.watch(f.default.resolve(r),(l,p)=>{s||(s=!0,b(t,n,{watch:{event:l,filename:p,file:r}}),setTimeout(()=>{s=!1},e.delay))})})},exports.writeFile=function(t,e){let n=d(e==null?void 0:e.path);const r=h.dirname(n);return c.mkdirSync(r,{recursive:!0}),c.writeFileSync(n,t.toString(),e==null?void 0:e.options),t};
