"use strict";Object.defineProperties(exports,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}});const a=require("fs"),y=require("path"),O=require("glob/sync.js"),k=e=>e&&typeof e=="object"&&"default"in e?e:{default:e};function _(e){if(e&&e.__esModule)return e;const t=Object.create(null,{[Symbol.toStringTag]:{value:"Module"}});if(e){for(const r in e)if(r!=="default"){const n=Object.getOwnPropertyDescriptor(e,r);Object.defineProperty(t,r,n.get?n:{enumerable:!0,get:()=>e[r]})}}return t.default=e,Object.freeze(t)}const q=k(a),l=k(y),h=k(O);function j(){return()=>{}}function T(e){return e}function w(){}function A(e){if(Array.isArray(e))return function(n){return n.map(s=>A(s))}(e);e=function(n={}){return function(s=j,o=T,i=w,d={}){n.src=s,n.proc=o,n.sink=i,n.meta=d}(n.src,n.proc,n.sink,n.meta),n}(e);let t=e.src,r=e.proc(t,e.meta);return e.sink(r,e.meta)}function p(e,t){return r=>e(r,t)}function m(e){return typeof e=="object"?y.format(e):e}const F="./src/task/*.js",E={glob:"./src/**/*.js",delay:100};let c;const u={},P=e=>u[e.id]=e,b=e=>u[e]!==void 0;function g(e,t,r){t={id:e,...t};const n=Date.now();u[e].main(t,r);const s=Date.now();return{start:n,stop:s,dur:s-n}}function I(e){const t={id:l.default.basename(c||"",l.default.extname(c||"")),url:c,...e};P(t)}function v(){process.listenerCount("task")==0&&process.on("task",I)}let f;function S(e=E.glob){return f=h.default(e),e}exports.bypass=T,exports.chain=function(e,t,r){let n,s;return{src(o){return e=o,this},done:()=>r,meta(o){return t=o,this},useProc(o){return n=o,this},proc(o,i){return i&&this.meta(i),typeof o=="object"&&(o=p(n,o)),e=o(e,t||{}),this},useSink(o){return s=o,this},sink(o,i){return i&&this.meta(i),typeof o=="object"&&(o=p(s,o)),r=o(e,t||{}),this},series(...o){return o.forEach(i=>this.proc(i)),this},parallel(...o){return o.forEach(i=>this.sink(i)),this}}},exports.clean=function e(t,r){return Array.isArray(t)?void t.forEach(n=>e(n)):(t=m(t),h.default(t).forEach(n=>{a.rmSync(n,{recursive:!0,force:!0,...r==null?void 0:r.options})}),t)},exports.dummySink=w,exports.dummySrc=j,exports.hasTask=b,exports.hasWatchables=()=>f.length>0,exports.initApi=()=>process.env.VESIC_API=!0,exports.initWatch=S,exports.isTaskRunnable=function(e){return!(!b(e)||!u[e].main)&&typeof u[e].main=="function"},exports.listenTask=v,exports.loadTasks=async function(e=F){v();const t=await h.default(e,{});for(let r of t)c=r,await Promise.resolve().then(()=>_(require(l.default.resolve(r))))},exports.meta=p,exports.parallel=function(...e){return(t,r)=>e.map(n=>n(t,r))},exports.print=function(e){console.log(e)},exports.readFile=function(e,t){return e=m(e||(t==null?void 0:t.path)),a.readFileSync(e,(t==null?void 0:t.options)||"utf-8")},exports.registerTask=P,exports.runTask=g,exports.series=function(...e){return(t,r)=>e.reduce((n,s)=>s(n,r),t)},exports.task=function(e){process.env.VESIC_API==="true"?process.emit("task",e):e.main()},exports.tasks=u,exports.unregisterTask=e=>u[e]=void 0,exports.vesic=A,exports.watchTask=function(e,t){t={...E,...t},!f&&S(t.glob);const r={id:e,...t};f.forEach((n,s)=>{let o=!1;q.default.watch(l.default.resolve(n),(i,d)=>{o||(o=!0,g(e,r,{watch:{event:i,filename:d,file:n}}),setTimeout(()=>{o=!1},t.delay))})})},exports.writeFile=function(e,t){let r=m(t==null?void 0:t.path);const n=y.dirname(r);return a.mkdirSync(n,{recursive:!0}),a.writeFileSync(r,e.toString(),t==null?void 0:t.options),e};
